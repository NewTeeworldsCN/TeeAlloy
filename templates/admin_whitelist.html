<!-- templates/admin_whitelist.html -->
{% extends "base.html" %}

{% block content %}
<div class="board-container">
  <div class="form-card" style="text-align: left;">
    <!-- å¤´éƒ¨ -->
    <div style="text-align: center; margin-bottom: 30px;">
      <div class="logo-badge" style="margin: 0 auto 16px;">ğŸ”</div>
      <h2>API ç™½åå•ç®¡ç†</h2>
      <p class="subtitle">ç®¡ç†å¯è°ƒç”¨ Game Token æ¥å£çš„æ¸¸æˆæœåŠ¡å™¨</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div style="margin-bottom: 20px;">
          {% for category, message in messages %}
            <p style="padding: 10px; margin: 0 0 10px; border-radius: 4px; background-color: 
              {% if category == 'error' %}#f8d7da; color: #721c24{% elif category == 'success' %}#d4edda; color: #155724{% else %}#d1ecf1; color: #0c5460{% endif %};">
              {{ message }}
            </p>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- æ·»åŠ è¡¨å• -->
    <form method="post" action="{{ url_for('admin.add_whitelist_entry') }}" style="...">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <h3>æ·»åŠ æ–°æœåŠ¡å™¨</h3>
      
      <label for="server_address">æœåŠ¡å™¨åœ°å€ï¼ˆIP æˆ–åŸŸåï¼‰:</label>
      <input type="text" name="server_address" id="server_address" required 
            style="width:100%; padding:8px; margin:4px 0; border:1px solid #ccc; border-radius:4px;">
      <small>ä¾‹å¦‚ï¼š192.168.1.100 æˆ– game.mygame.com</small><br><br>

      <button type="submit" class="btn btn-primary">ç”Ÿæˆå¯†é’¥å¹¶æ·»åŠ </button>
    </form>

    <!-- å½“å‰åˆ—è¡¨ -->
    <h3>å½“å‰ç™½åå• (å…± {{ total_count }} æ¡)</h3>
    {% if grouped_servers %}
      {% for addr, keys in grouped_servers.items() %}
        <div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
          <strong style="font-size: 1.1em;">ğŸ“ {{ addr }}</strong>
          <ul style="list-style: none; padding: 0; margin: 10px 0 0 0;">
            {% for key in keys %}
              <li style="margin: 8px 0; padding: 8px; background:#fff; border:1px solid #eee; border-radius:4px; font-size:0.9em;">
                {% if key.show_plaintext %}
                  <strong>æ–°åˆ›å»ºçš„å¯†é’¥ï¼š</strong><br>
                  <code style="color: #c7254e; background-color: #f9f2f4; padding: 5px; border-radius: 3px; font-size: 1em; word-break: break-all;">
                    {{ key.plaintext_api_key }}
                  </code><br>
                  <small style="color: #666;">è¯·ç«‹å³ä¿å­˜ï¼åˆ·æ–°åå°†åªæ˜¾ç¤ºå“ˆå¸Œã€‚</small><br>
                {% endif %}
                <code style="font-size:0.85em;">{{ key.api_key_hash[:16] }}...{{ key.api_key_hash[-16:] }}</code>
                <span style="color:#666; font-size:0.8em;">(æ·»åŠ äº {{ key.created_at.strftime('%Y-%m-%d %H:%M') }})</span>
                <a href="{{ url_for('admin.remove_whitelist_entry', server_addr=addr, api_key_hash=key.api_key_hash) }}"
                   onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯†é’¥å—ï¼Ÿ');"
                   style="float:right; color:#dc3545; text-decoration:underline;">
                  åˆ é™¤
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    {% else %}
      <p><em>æš‚æ— ç™½åå•è®°å½•ã€‚</em></p>
    {% endif %}

    <!-- è¿”å›é“¾æ¥ -->
    <div style="margin-top: 30px; text-align: center;">
      <a href="{{ url_for('admin.admin_panel') }}" class="btn btn-secondary" style="padding: 12px 24px; display: inline-block; width: auto;">
        è¿”å›ç®¡ç†å‘˜é¢æ¿
      </a>
    </div>
  </div>
</div>
{% endblock %}