<!-- templates/admin_whitelist.html -->
{% extends "base.html" %}

{% block content %}
<div class="board-container">
  <div class="form-card" style="text-align: left;">
    <!-- å¤´éƒ¨ -->
    <div style="text-align: center; margin-bottom: 30px;">
      <div class="logo-badge" style="margin: 0 auto 16px;">ğŸ”</div>
      <h2>API ç™½åå•ç®¡ç†</h2>
      <p class="subtitle">ç®¡ç†å¯è°ƒç”¨ Game Token æ¥å£çš„æ¸¸æˆæœåŠ¡å™¨</p>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flashes">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- æ·»åŠ è¡¨å• -->
    <form method="post" action="{{ url_for('admin.add_whitelist_entry') }}" style="margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <h3 style="margin-top: 0;">â• æ·»åŠ æ–°æœåŠ¡å™¨</h3>
      
      <label for="server_address">æœåŠ¡å™¨åœ°å€ï¼ˆIP æˆ–åŸŸåï¼‰:</label>
      <input type="text" name="server_address" id="server_address" required style="width:100%; padding:8px; margin:4px 0; border:1px solid #ccc; border-radius:4px;">
      <small>ä¾‹å¦‚ï¼š192.168.1.100 æˆ– game.mygame.com</small><br><br>

      <label for="api_key">API å¯†é’¥ï¼ˆæ˜æ–‡ï¼‰:</label>
      <input type="text" name="api_key" id="api_key" required style="width:100%; padding:8px; margin:4px 0; border:1px solid #ccc; border-radius:4px;">
      <small>å»ºè®®ä½¿ç”¨é«˜å¼ºåº¦éšæœºå­—ç¬¦ä¸²ï¼ˆå¦‚ 32 å­—ç¬¦ä»¥ä¸Šï¼‰</small><br><br>

      <button type="submit" class="btn btn-primary">æ·»åŠ åˆ°ç™½åå•</button>
    </form>

    <!-- å½“å‰åˆ—è¡¨ -->
    <h3>å½“å‰ç™½åå• (å…± {{ total_count }} æ¡)</h3>
    {% if grouped_servers %}
      {% for addr, keys in grouped_servers.items() %}
        <div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
          <strong style="font-size: 1.1em;">ğŸ“ {{ addr }}</strong>
          <ul style="list-style: none; padding: 0; margin: 10px 0 0 0;">
            {% for key in keys %}
              <li style="margin: 8px 0; padding: 8px; background:#fff; border:1px solid #eee; border-radius:4px; font-size:0.9em;">
                <code style="font-size:0.85em;">{{ key.api_key_hash[:16] }}...{{ key.api_key_hash[-16:] }}</code>
                <span style="color:#666; font-size:0.8em;">(æ·»åŠ äº {{ key.created_at.strftime('%Y-%m-%d %H:%M') }})</span>
                <a href="{{ url_for('admin.remove_whitelist_entry', server_addr=addr, api_key_hash=key.api_key_hash) }}"
                   onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯†é’¥å—ï¼Ÿ');"
                   style="float:right; color:#dc3545; text-decoration:underline;">
                  åˆ é™¤
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    {% else %}
      <p><em>æš‚æ— ç™½åå•è®°å½•ã€‚</em></p>
    {% endif %}

    <!-- è¿”å›é“¾æ¥ -->
    <div style="margin-top: 30px; text-align: center;">
      <a href="{{ url_for('admin.admin_panel') }}" class="btn btn-secondary" style="padding: 12px 24px; display: inline-block; width: auto;">
            è¿”å›ç®¡ç†å‘˜é¢æ¿
      </a>
      </div>
  </div>
</div>
{% endblock %}
